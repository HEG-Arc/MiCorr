<section ng-controller="ShowStratCtrl">
<div class="container" ng-show="hasPendingRequests()">
    <div class="loader">
        <div class="loader--dot"></div>
        <div class="loader--dot"></div>
        <div class="loader--dot"></div>
        <div class="loader--dot"></div>
        <div class="loader--dot"></div>
        <div class="loader--dot"></div>
        <div class="loader--text"></div>
    </div>
</div>
<div class="container-fluid" ng-hide="hasPendingRequests()">
    <div class="row">
        <div class="col-md-6">
            <ol class="breadcrumb">
                <li><a href="/">Home</a></li>
                <li><a href="/micorr/#/stratigraphy/{{stratigraphyName}}">{{stratigraphyDescription}}</a></li>
            </ol>
        </div>
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-3 text-center" ng-controller="ModalAddStrataCtrl">
                    <script type="text/ng-template" id="modalAddStrata.html">
                        <div class="modal-header">
                            <h3 class="modal-title">Add a stratum</h3>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="form-group">
                                    <label for="natureFamily">Stratum Type</label>
                                    <select ng-model="nature" id="natureFamily" class="form-control"
                                            ng-options="nature.description for nature in natures.natures track by nature.code">
                                        <option value=""></option>
                                    </select>
                                </div>
                            </form>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-primary" ng-click="ok()">OK</button>
                            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
                        </div>
                    </script>
                    <button type="button" class="btn btn-primary" ng-click="open()">
                        <span class="glyphicon glyphicon glyphicon-plus" aria-hidden="true"></span>
                        Add a stratum
                    </button>
                </div>
                <div class="col-md-2 text-center">
                    <div ng-controller="ModalSaveStrataCtrl">
                        <script type="text/ng-template" id="saveStrataContent.html">
                            <div>
                                <div class="modal-header">
                                    <h3 class="modal-title">Save this stratum</h3>
                                </div>
                                <div class="modal-body">
                                    <p>Do you really want to save this stratum ?</p>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-primary" ng-click="ok()">OK</button>
                                    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
                                </div>
                            </div>
                        </script>

                        <script type="text/ng-template" id="sendStrataContent.html">
                            <div>
                                <div class="modal-header">
                                    <h3 class="modal-title">Save this stratum</h3>
                                </div>
                                <div class="modal-body">
                                    <p>You're not logged in! provide an email address to receive the link.</p>
                                    <input ng-model="email_to" type="text" placeholder="john.doe@example.com"></input>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-primary" ng-click="send()">Send</button>
                                    <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
                                </div>
                            </div>
                        </script>

                        <button ng-show="is_authenticated" ng-click="open('sm')" type="button" class="btn btn-primary">
                            <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span>
                            Save
                        </button>

                        <button ng-show="!is_authenticated" ng-click="open_send('sm')" type="button" class="btn btn-primary">
                            <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span>
                            Save
                        </button>

                    </div>
                </div>
                <div class="col-md-2 text-center">

                    <div ng-controller="ModalShowSimilarStrataCtrl">
                        <script type="text/ng-template" id="showSimilarStrataContent.html">
                            <div class="modal-header">
                                <h3 class="modal-title">List of similar artefacts</h3>
                            </div>
                            <div class="modal-body">
                                <table class="table table-hover">
                                    <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Picture</th>
                                        <th>Matching 100%</th>
                                        <th>Metal Family</th>
                                        <th>Metal Alloy</th>
                                        <th>Object</th>
                                        <th>Chronology</th>
                                        <th>Technology</th>
                                        <th>Microstructure</th>

                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat='result in results'>
                                        <td><strong>{{$index + 1}}</strong></td>
                                        <td><a href='/micorr/#/stratigraphy/{{ result.stratigraphy_uid }}' target="_blank">
                                                <img src="{{ result.node_base_url }}getStratigraphySvg?name={{ result.stratigraphy_uid }}&amp;width=100">
                                            </a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.matching100 }}</a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.artefact_metal_e_1 }}</a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.artefact_alloy }}</a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.artefact_type }}</a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.artefact_chronology_category }}</a></td>
                                        <td><a href='/artefacts/{{ result.artefact_id }}' target="_blank">{{ result.artefact_technology }}</a></td>
                                        <td>{{ result.artefact_microstructure }}</td>

                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" ng-click="ok()">OK</button>
                            </div>
                        </script>

                        <button ng-click="open('lg')" type="button" class="btn btn-primary">
                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                            Find similar
                        </button>
                    </div>
                </div>
                <div class="col-md-2 text-center">
                    <div ng-controller="ModalExportStrataCtrl">
                        <script type="text/ng-template" id="exportStrataContent.html">
                            <div class="modal-header">
                                <h3 class="modal-title">Export to PNG</h3>
                            </div>
                            <div class="modal-body">
                                <p>Right click to download a stratum.</p>
                                <img ng-src="/{{ imgUrl }}"/>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" ng-click="ok()">OK</button>
                            </div>
                        </script>

                        <button ng-click="open('lg')" type="button" class="btn btn-primary">
                            <span class="glyphicon glyphicon-share-alt" aria-hidden="true"></span>
                            Export to PNG
                        </button>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <!-- DELETE STRATA BUTTON
                    <div ng-controller="ModalDelStrataCtrl">
                        <script type="text/ng-template" id="delStrataContent.html">
                            <div class="modal-header">
                                <h3 class="modal-title">Delete this stratum</h3>
                            </div>
                            <div class="modal-body">
                                <p>Do you really want to delete this stratum ?</p>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" ng-click="ok()">OK</button>
                                <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
                            </div>
                        </script>

                        <button class="btn btn-primary" ng-click="open('sm')">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            Delete this stratum
                        </button>
                    </div>
                    -->
                </div>
            </div>

        </div>
    </div>
</div>

<div class="container-fluid" ng-hide="hasPendingRequests()">
<div class="row">
<div class="col-md-6">
<div ng-controller="TabsStrataCtrl">
<div ng-hide="showTabForms">
    <div class="jumbotron">
        <h1>Stratigraphy visualizer</h1>

        <p>Please select or add a stratum to show its properties.</p>
    </div>
</div>

<div class="row-fluid" ng-show="showTabForms">
    <div class="col-md-6">
        <h1 class="ng-binding minititle">
            {{ natureFamilyname }} Stratum : {{ strataName }}
        </h1>
    </div>
    <div class="col-md-6">
        <h1 class="ng-binding minititle">
            Observation mode:
            <toggle-switch
                    ng-model="observationMode.binocular"
                    on-label="Binocular"
                    off-label="Cross-section"
                    class="switch-large switch-default">
            </toggle-switch>
        </h1>
    </div>
</div>

<tabset ng-show="showTabForms" justified="true" class="clearfix">
<tab heading="Morphology" active="activeMorphologyTab" tooltip="{{descriptions.fgMorphology}}">
    <form>
       <div ng-controller="StratMorphologyCtrl" class="row-fluid">
           <fieldset ng-repeat="fieldset in fieldsets | filter:showFamily ">
               <legend ng-if="fieldset.name!='default'">{{ fieldset.name }}</legend>
               <div class="col-md-6 form-group" ng-repeat="family in fieldset.families track by family.uid">
                   <label for="{{ 'morphology' + family.name }}">
                       <span class="glyphicon" ng-class="family.visible ? 'glyphicon-eye-open' : 'glyphicon-eye-close'"
                             }} tooltip="{{ (family.visible ? '' :'no') + 'visual impact on the stratum'}}"></span>
                       <span tooltip="{{ descriptions[family.uid] }}"> {{ family.name }}
                        <span class="unit" ng-if="family.unit">{{ '(in ' + family.unit +')'}}</span>
                    </span>
                   </label>
                   <ui-select ng-if="!family.variable" id="{{ 'morphology' + family.name }}"
                              dynamic-model="'selected.'+family.uid" on-select="upMorpho()" on-remove="upMorpho()">
                       <ui-select-match placeholder="Select characteristic">
                           <span tooltip="{{ $select.selected.description }}">{{$select.selected.real_name}}</span>
                       </ui-select-match>
                       <ui-select-choices null-option="nullOption" group-by="getGroup"
                                          repeat="item in (this[family.uid] | filter: $select.search) track by item.name">
                           <div tooltip="{{ item.description }}" ng-style="family.uid=='colourFamily' ? {'background-color':item.color} : ''">
                               <img ng-if="item.image_url" ng-src="{{ item.image_url }}" aria-hidden="true"
                                    heigth="100px">
                               <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                           </div>
                       </ui-select-choices>
                   </ui-select>
                   <input ng-if="family.variable" id="{{ 'morphology' + family.name }}" class="form-control"
                          dynamic-model="'selected.'+family.uid" type="text" smart-float ng-change="upMorpho()">
                   </input>
               </div>
           </fieldset>
       </div>
    </form>
</tab>
<tab heading="Texture" tooltip="{{descriptions.fgTexture}}">
    <form ng-controller="StratTextureCtrl">
        <div class="row-fluid">
           <fieldset ng-repeat="fieldset in fieldsets | filter:showFamily ">
                <legend ng-if="fieldset.name!='default'">{{ fieldset.name }}</legend>
            <div class="col-md-6 form-group" ng-repeat="family in fieldset.families track by family.uid">
                <label class="control-label" for="{{ 'texture' + family.name }}">
                <span class="glyphicon" ng-class="family.visible ? 'glyphicon-eye-open' : 'glyphicon-eye-close'" }}
                      tooltip="{{ (family.visible ? '' :'no') + 'visual impact on the stratum'}}"></span>
                    <span tooltip="{{ family.description }}"> {{ family.name }}
                    <span class="unit" ng-if="family.unit">{{ '(in ' + family.unit +')'}}</span>
                </span>
                </label>
                <ui-select ng-if="!family.variable" id="{{ 'texture' + family.name }}"
                           theme="bootstrap" dynamic-model="'selected.'+family.uid" on-select="upTexture()"
                           on-remove="upTexture()">
                     <ui-select-match placeholder="Select characteristic">
                         <span tooltip="{{ $select.selected.description }}" >{{$select.selected.real_name}}</span>
                    </ui-select-match>
                    <ui-select-choices null-option="nullOption" repeat="item in (this[family.uid] | filter: $select.search) track by item.name">
                        <div tooltip="{{ item.description }}">
                            <img ng-if="item.image_url" ng-src="{{ item.image_url }}" aria-hidden="true" heigth="100px">
                            <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                        </div>
                    </ui-select-choices>
                </ui-select>
                <input ng-if="family.variable" id="{{ 'texture' + family.name }}" class="form-control"
                       dynamic-model="'selected.'+family.uid" type="text" smart-float
                       ng-change="upTexture()">
                </input>
            </div>
           </fieldset>
        </div>
    </form>
</tab>

    <tab heading="Microstructure" tooltip="{{descriptions.fgMicrostructure}}">
    <form ng-controller="StratNewMicrostructureCtrl">
        <div class="row-fluid">
            <div class="col-md-6 form-group" ng-repeat="family in familyGroup | filter : showFamily track by family.uid">
                <label class="control-label" for="{{ 'microstructure' + family.name }}">
                <span class="glyphicon" ng-class="family.visible ? 'glyphicon-eye-open' : 'glyphicon-eye-close'" }}
                      tooltip="{{ (family.visible ? '' :'no') + 'visual impact on the stratum'}}"></span>
                    <span tooltip="{{ family.description }}"> {{ family.name }}
                    <span class="unit" ng-if="family.unit">{{ '(in ' + family.unit +')'}}</span>
                </span>
                </label>
                <ui-select ng-if="!family.variable" id="{{ 'microstructure' + family.name }}"
                           theme="bootstrap" dynamic-model="'selected.'+family.uid" on-select="updateModel()"
                           on-remove="updateModel()">
                     <ui-select-match placeholder="Select characteristic">
                         <span tooltip="{{ $select.selected.description }}" >{{$select.selected.real_name}}</span>
                    </ui-select-match>
                    <ui-select-choices null-option="nullOption" group-by="getGroup" repeat="item in (this[family.uid] | filter: $select.search) track by item.name">
                        <div tooltip="{{ item.description }}">
                            <img ng-if="item.image_url" ng-src="{{ item.image_url }}" aria-hidden="true" heigth="100px">
                            <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                        </div>
                    </ui-select-choices>
                </ui-select>
                <input ng-if="family.variable" id="{{ 'microstructure' + family.name }}" class="form-control"
                       dynamic-model="'selected.'+family.uid" type="text" smart-float
                       ng-change="updateModel()">
                </input>
            </div>
        </div>
    </form>
</tab>

<tab heading="OldMicro"  title="{{descriptions.fgMicrostructure}}">
    <form ng-controller="StratMicrostructureCtrl">
        <!-- Microstructure pour la couche CM -->

        <div class="col-md-12 form-group" ng-show="corrodedMetalStrataSelected">
            <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                               title="no visual impact on the stratum"></span> <span title="{{descriptions.cmCpMicrostructureFamily}}">Additional microstructure
                in CP</span></span>
            </label>
            <picklist element-name="sub-characteristics" size="10" data-picklist="" data-pick-model="selectedCmcpmicrostructureFamily"
                      data-pick-options="v.real_name for v in cmCpMicrostructureFamily"/>
        </div>


        <!-- Microstructure pour les autres strates-->
        <div class="row-fluid">
            <div ng-show="showCmlevelofcorrosionFamily" class="col-md-6 form-group">
                <label for="cmLevelOfCorrosionFamily">Level of corrosion</label>
                <select id="cmLevelOfCorrosionFamily" class="form-control" ng-model="selectedCmlevelofcorrosionFamily"
                        ng-options="x.real_name for x in cmLevelOfCorrosionFamily" ng-change="upMicrostructure()">
                    <option value="" ></option>
                </select>
            </div>
            <div ng-show="showcprimicrostructureFamily" class="col-md-6 form-group">
                <label for="cpriMicrostructureFamily"><span class="glyphicon glyphicon-eye-open"
                                                            title="visual impact on the stratum"></span>
                    <span title="{{descriptions.cpriMicrostructureFamily}}">Microstructure</span></label>
                <select id="cpriMicrostructureFamily" class="form-control" ng-model="selectedCprimicrostructureFamily"
                        ng-options="x.real_name for x in cpriMicrostructureFamily" ng-change="upMicrostructure()">
                    <option value="" ></option>
                </select>
            </div>
        </div>
        <div class="row-fluid">
            <!-- sub CM Level of Corrosion n'est pas affiché pour l'instant. Demander à Christian Degrigny pourquoi
            <div ng-show="showsubcmlevelofcorrosionFamily" class="col-md-6 form-group">
                <label for="subcmlevelofcorrosionFamily">Sub CM Level of corrosion</label>
                <select id="subcmlevelofcorrosionFamily" class="form-control" ng-model="selectedSubcmlevelofcorrosionFamily" ng-options="x.name for x in subcmlevelofcorrosionFamily" ng-change="upMicrostructure()">
                    <option value="" ></option>
                </select>
            </div>-->
        </div>
        <div class="row-fluid">


            <div ng-show="showmmicrostructureFamily" class="col-md-6 form-group">
                <label for="mMicrostructureFamily"><span class="glyphicon glyphicon-eye-open"
                                                         title="visual impact on the stratum"></span>
                    <span title="{{descriptions.mMicrostructureFamily}}">Microstructure</span></label>
                <select id="mMicrostructureFamily" class="form-control" ng-model="selectedMmicrostructureFamily"
                        ng-options="x.real_name for x in mMicrostructureFamily" ng-change="upMicrostructure()">
                    <option value="" ></option>
                </select>
            </div>

        </div>

        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="showsubcprimicrostructureFamily">
                <label class="control-label"><span class="glyphicon glyphicon-eye-open"
                                                   title="visual impact on the stratum"></span>
                    <span title="{{ descriptions.subcprimicrostructureFamily }}">{{ selectedCprimicrostructureFamily.real_name | capitalize }}</span>
                </label>
                <picklist element-name="sub-characteristics" size="10" data-picklist="" data-pick-model="selectedSubcprimicrostructureFamily"
                          data-pick-options="v.sub_real_name for v in selectedCprimicrostructureFamily.subcharacteristics"/>
            </div>
        </div>
        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="showsubmmicrostructureFamily">
                <label class="control-label"><span class="glyphicon glyphicon-eye-open"
                                                   title="visual impact on the stratum"></span>
                 <span title="{{ descriptions.submmicrostructureFamily }}">{{ selectedMmicrostructureFamily.real_name | capitalize}}</span>
                </label>
                <picklist element-name="sub-characteristics" size="10" data-picklist="" data-pick-model="selectedSubmmicrostructureFamily"
                          data-pick-options="v.sub_real_name for v in selectedMmicrostructureFamily.subcharacteristics"/>
            </div>
        </div>

    </form>
</tab>
<tab heading="Composition"  title="{{descriptions.fgComposition}}">
    <form ng-controller="StratCompositionCtrl">
        <!-- Composition pour la couche CM -->
        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="corrodedMetalStrataSelected">
                <label for="mcpRatio">
                    <span class="glyphicon glyphicon-eye-open" title="visual impact on the stratum"></span>
                    <span title="{{ descriptions.mcpRatio }}">M/CP Ratio (low / average / high) </span>
                </label>
                <input id="mcpRatio" type="range" min="1" max="3" list="tickmarks" ng-model="ratio.ratio"
                       ng-change="ratioChange()">
                <datalist id="tickmarks">
                    <option value="1" label="Low">
                    <option value="2" label="Average">
                    <option value="3" label="High">
                </datalist>
                </input>
            </div>
        </div>
        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="corrodedMetalStrataSelected">
                <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                                   title="no visual impact on the stratum"></span>
                <span title="{{ descriptions.cmmcompositionFamily }}">Additional elements in M</span>
                </label>
                <ui-select id="cmmCompositionAdditionalElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cmmCompositionAdditionalElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cmmCompositionAdditionalElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="corrodedMetalStrataSelected">
                <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                                   title="no visual impact on the stratum"></span>
                     <span title="{{ descriptions.cmcpcompositionFamily }}">Additional elements in CP</span>
                </label>
                  <ui-select id="cmcpCompositionAdditionalElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cmcpCompositionAdditionalElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cmcpCompositionAdditionalElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>

        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="showcmcpagCompositionAdditionalElements">
                <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                                   title="no visual impact on the stratum"></span>
                 <span title="{{ descriptions.cmcpaggregateCompositionFamily }}">Additional element(s) in CP aggregates</span>
                </label>
                <ui-select id="cmcpagCompositionAdditionalElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cmcpagCompositionAdditionalElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cmcpagCompositionAdditionalElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>

        <!-- Fin couche CM-->
        <div class="row-fluid">
             <!-- Soil composition -->
            <div ng-show="showsCompositionMainElements" class="col-md-6 form-group">
                <label for="sCompositionMainElements"><span class="glyphicon glyphicon-eye-close"
                                                      title="no visual impact on the stratum"></span>
                 <span title="{{ descriptions.sCompositionMainElements }}">Main element(s)</span>
                </label>
                <ui-select id="sCompositionMainElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="sCompositionMainElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (sCompositionMainElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div ng-show="showsCompositionSecondaryElements" class="col-md-6 form-group">
                <label for="sCompositionSecondaryElements"><span class="glyphicon glyphicon-eye-close"
                                                         title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.sCompositionSecondaryElements }}">Secondary element(s)</span>
                </label>
                <ui-select id="sCompositionSecondaryElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="sCompositionSecondaryElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select elements by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (sCompositionSecondaryElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <!-- End Soil composition -->

            <div ng-show="shownmmComposition" class="col-md-6 form-group">
                <label for="nmmCompositionFamily">Composition</label>
                <select id="nmmCompositionFamily" class="form-control" ng-model="selectedNmmcompositionFamily"
                        ng-options="x.real_name for x in nmmCompositionFamily" ng-change="upComposition()">
                    <option value="" ></option>
                </select>
            </div>
            <div ng-show="shownmmComposition" class="col-md-6 form-group">
                <label for="nmmCompositionNonOrganicElements"> <span class="glyphicon glyphicon-eye-close"
                                                            title="no visual impact on the stratum"></span>
                    Non organic element(s)</label>
                <ui-select id="nmmCompositionNonOrganicElements" class="form-control" multiple theme="bootstrap"
                           ng-model="nmmCompositionNonOrganicElements.selected" on-remove="upComposition()" on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (nmmCompositionNonOrganicElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <!-- Deposit composition -->
            <div ng-show="showdCompositionMainElements" class="col-md-6 form-group">
                <label for="dCompositionMainElements"><span class="glyphicon glyphicon-eye-close"
                                                      title="no visual impact on the stratum"></span>
                 <span title="{{ descriptions.dCompositionMainElements }}">Main element(s)</span>
                </label>
                <ui-select id="dCompositionMainElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="dCompositionMainElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (dCompositionMainElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div ng-show="showdCompositionSecondaryElements" class="col-md-6 form-group">
                <label for="dCompositionSecondaryElements"><span class="glyphicon glyphicon-eye-close"
                                                         title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.dCompositionSecondaryElements }}">Secondary element(s)</span>
                </label>
                <ui-select id="dCompositionSecondaryElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="dCompositionSecondaryElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select elements by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (dCompositionSecondaryElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <!-- End Deposit composition -->
            <div ng-show="showPomcomposition" class="col-md-6 form-group">
                <label for="pomCompositionFamily"> <span class="glyphicon glyphicon-eye-close"
                                                         title="no visual impact on the stratum"></span>
                    Organic material
                </label>
                <select id="pomCompositionFamily" class="form-control" ng-model="selectedPomcompositionFamily"
                        ng-options="x.real_name for x in pomCompositionFamily" ng-change="upComposition()">
                    <option value="" ></option>
                </select>
            </div>
            <div ng-show="showPomcomposition" class="col-md-6 form-group">
                <label for="pomCompositionMetallicPollutants"> <span class="glyphicon glyphicon-eye-close"
                                                            title="no visual impact on the stratum"></span>
                    Metallic pollutant(s)</label>
                <ui-select id="pomCompositionMetallicPollutants" class="form-control" multiple theme="bootstrap"
                           ng-model="pomCompositionMetallicPollutants.selected" on-remove="upComposition()" on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (pomCompositionMetallicPollutants.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <div ng-show="showmCompositionMainElements" class="col-md-6 form-group">
                <label for="mCompositionMainElements"><span class="glyphicon glyphicon-eye-close"
                                                      title="no visual impact on the stratum"></span>
                 <span title="{{ descriptions.mCompositionMainElements }}">Main element(s)</span>
                </label>
                <ui-select id="mCompositionMainElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="mCompositionMainElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (mCompositionMainElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div ng-show="showcpCompositionMainElements" class="col-md-6 form-group">
                <label for="cpCompositionMainElements"><span class="glyphicon glyphicon-eye-close"
                                                       title="no visual impact on the stratum"></span>
                     <span title="{{ descriptions.cpCompositionMainElements }}">Main element(s)</span>
                </label>
                <ui-select id="cpCompositionMainElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cpCompositionMainElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cpCompositionMainElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <div ng-show="showcpCompositionSecondaryElements" class="col-md-6 form-group">
                <label for="cpCompositionSecondaryElements"><span class="glyphicon glyphicon-eye-close"
                                                          title="no visual impact on the stratum"></span>
                     <span title="{{ descriptions.cpCompositionSecondaryElements }}">Secondary element(s)</span>
                </label>
                <ui-select id="cpCompositionSecondaryElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cpCompositionSecondaryElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cpCompositionSecondaryElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div ng-show="showcpCompositionCompounds" class="col-md-6 form-group">
                <label for="cpCompositionCompounds"><span class="glyphicon glyphicon-eye-close"
                                                             title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.cpCompositionCompounds }}">Compound</span>
                </label>
                <br>
               <ui-select id="filterCompoundsMethod" ng-model="filterCompoundsMethod.selected"  theme="bootstrap">
                     <ui-select-match placeholder="Search compounds...">
                        {{$select.selected.text}}
                    </ui-select-match>
                    <ui-select-choices repeat="item in (filterCompoundsMethod.options | filter: $select.search) track by item.value">
                        <span ng-bind-html="item.text | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
                <br>

                <ui-select id="cpCompositionCompounds" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cpCompositionCompounds.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select compound">
                        {{$item.real_name}}
                    </ui-select-match>
                    <ui-select-choices repeat="item in (cpCompositionCompounds.characteristics | filterCompounds:cpCompositionMainElements:cpCompositionSecondaryElements:filterCompoundsMethod.selected.value | filter: $select.search) track by item.name">
                        <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">

            <div class="col-md-12 form-group" ng-show="showcpCompositionAdditionalElements">
                <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                                   title="no visual impact on the stratum"></span>
                     <span title="{{ descriptions.cpCompositionAdditionalElements }}">Additional element(s)</span>
                </label>
                 <ui-select id="cpCompositionAdditionalElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="cpCompositionAdditionalElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (cpCompositionAdditionalElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <!-- CP Microstructure composition -->
        <div ng-repeat='secondaryComponent in secondaryComponents'>
        <div class="row-fluid">
            <div ng-show="showcpSdyCptMainElements" class="col-md-6 form-group">
                <label for="{{'cpSdyCpt' + $index + 'mainElements'}}"><span class="glyphicon glyphicon-eye-close"
                                                       title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.cpSdyCptMainElements }}">{{ cpriMicrostructureOptionTitle }} main element(s)</span>
                </label>
                  <ui-select id="{{'cpSdyCpt' + $index + 'mainElements'}}" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="secondaryComponent.mainElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (secondaryComponent.mainElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <div ng-show="showcpSdyCptSecondaryElements" class="col-md-6 form-group">
                <label for="{{'cpSdyCpt' + $index + 'secondaryElements'}}"><span class="glyphicon glyphicon-eye-close"
                                                          title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.cpSdyCptSecondaryElements }}">{{ cpriMicrostructureOptionTitle }}  secondary element(s)</span>
                </label>
                 <ui-select id="{{'cpSdyCpt' + $index + 'secondaryElements'}}" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="secondaryComponent.secondaryElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (secondaryComponent.secondaryElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div ng-show="showcpSdyCptCompounds" class="col-md-6 form-group">
                <label for="{{'cpSdyCpt' + $index + 'Compounds' }}"><span class="glyphicon glyphicon-eye-close"
                                                             title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.cpSdyCptCompounds }}">{{ cpriMicrostructureOptionTitle }}  compound</span>
                </label>
                <ui-select id="{{'cpSdyCpt' + $index + 'filterCompoundsMethod'}}" ng-model="secondaryComponent.filterCompoundsMethod.selected"  theme="bootstrap">
                     <ui-select-match placeholder="Search compounds...">
                        {{$select.selected.text}}
                    </ui-select-match>
                    <ui-select-choices repeat="item in (secondaryComponent.filterCompoundsMethod.options | filter: $select.search) track by item.value">
                        <span ng-bind-html="item.text | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
                <br>
                 <ui-select id="{{'cpSdyCpt' + $index + 'compounds'}}" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="secondaryComponent.compounds.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select compound">
                        {{$item.real_name}}
                    </ui-select-match>
                    <ui-select-choices repeat="item in (secondaryComponent.compounds.characteristics | filterCompounds:secondaryComponent.mainElements:secondaryComponent.secondaryElements:secondaryComponent.filterCompoundsMethod.selected.value | filter: $select.search) track by item.name">
                        <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        <div class="row-fluid">
            <div class="col-md-12 form-group" ng-show="showcpSdyCptAdditionalElements">
                <label class="control-label"><span class="glyphicon glyphicon-eye-close"
                                                   title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.cpSdyCptAdditionalElements }}">{{ cpriMicrostructureOptionTitle }}  additional element(s)</span>
                </label>
                <ui-select id="{{ 'cpSdyCpt' + $index + 'additionalElements'}}" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="secondaryComponent.additionalElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select element(s) by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (secondaryComponent.additionalElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>
        </div>
        <!-- End CP Microstructure composition -->

        <div class="row-fluid">
            <div ng-show="showmCompositionSecondaryElements" class="col-md-6 form-group">
                <label for="mCompositionSecondaryElements"><span class="glyphicon glyphicon-eye-close"
                                                         title="no visual impact on the stratum"></span>
                    <span title="{{ descriptions.mCompositionSecondaryElements }}">Secondary element(s)</span>
                </label>
                <ui-select id="mCompositionSecondaryElements" class="form-control" multiple
                           theme="bootstrap"
                           ng-model="mCompositionSecondaryElements.selected" on-remove="upComposition()"
                           on-select="upComposition()">
                    <ui-select-match placeholder="Select elements by order of importance">
                        {{$item.symbol}}
                    </ui-select-match>
                    <ui-select-choices group-by="'category'"
                                       repeat="item in (mCompositionSecondaryElements.characteristics | filter: $select.search) track by item.symbol">
                        <span ng-bind-html="item.symbol | highlight: $select.search"></span> <span
                            ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
        </div>

    </form>
</tab>
<tab heading="Interface" active="activeTabInterface" tooltip="{{descriptions.fgInterface}}">
    <div ng-controller="StratInterfaceCtrl"  class="row-fluid">
           <fieldset ng-repeat="fieldset in fieldsets | filter:showFamily">
                <legend ng-if="fieldset.name!='default'">{{ fieldset.name }}</legend>
            <div class="col-md-6 form-group" ng-repeat="family  in fieldset.families track by family.uid">
            <label for="{{ 'interface' + family.name }}">
                <span class="glyphicon" ng-class="family.visible ? 'glyphicon-eye-open' : 'glyphicon-eye-close'" }}
                      tooltip="{{ (family.visible ? '' :'no') + 'visual impact on the stratum'}}"></span>
                <span tooltip="{{ family.description }}"> {{ family.name }}
                        <span class="unit" ng-if="family.unit">{{ '(in ' + family.unit +')'}}</span>
                </span>
            </label>
            <ui-select ng-if="!family.variable" id="{{ 'interface' + family.name }}"
                    dynamic-model="'selected.'+family.uid" on-select="upModel()"
                    on-remove="upModel()">
                <ui-select-match placeholder="Select characteristic">
                    <span tooltip="{{ $select.selected.description }}">{{$select.selected.real_name}}</span>
                </ui-select-match>
                <ui-select-choices null-option="nullOption" group-by="getGroup"
                                   repeat="item in (this[family.uid] | filter: $select.search) track by item.name">
                    <div tooltip="{{ item.description }}">
                        <img ng-if="item.image_url" ng-src="{{ item.image_url }}" aria-hidden="true" heigth="100px">
                        <span ng-bind-html="item.real_name | highlight: $select.search"></span>
                    </div>
                </ui-select-choices>
            </ui-select>
            <input ng-if="family.variable" id="{{ 'interface' + family.name }}" class="form-control"
                   dynamic-model="'selected.'+family.uid" type="text" smart-float
                    ng-change="updateModel()">
            </input>
        </div>
     </fieldset>
    </div>
</tab>
</tabset>
</div>

</div>
<div class="col-md-6">
    <div id="stratasvg">
        <div id="stratasvg_{{$index}}" class="row" ng-repeat="strata in stratas">
            <stratainfo index="{{$index}}"></stratainfo>
            <strata index="{{$index}}"></strata>
        </div>
    </div>
</div>

</div>
</div>

</section>
