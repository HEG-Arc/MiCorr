from django.test import TestCase, Client

from jsoncompare import  jsoncompare
from deepdiff import DeepDiff
import json

STRATIGRAPHY_REFS = {
#'67d11e72-2574-11e6-a316-000c29148083':{"strata": [{"name": "67d11e72-2574-11e6-a316-000c29148083_Strata1", "characteristics": [{"visible": False, "order": 13, "name": "cpExtensionSi", "family": "cpCompositionExtensionFamily", "real_name": "Si"}, {"visible": False, "order": 3, "name": "cpCuCharacteristic", "family": "cpCompositionFamily", "real_name": "Cu"}, {"visible": True, "order": 6, "name": "noMicrostructureCharacteristic", "family": "cpriMicrostructureFamily", "real_name": "no microstructure"}, {"visible": True, "order": 1, "name": "branchedCracksCharacteristic", "family": "crackingFamily", "real_name": "branched cracks"}, {"visible": False, "order": 6, "name": "toughCharacteristic", "family": "cohesionFamily", "real_name": "tough"}, {"visible": False, "order": 3, "name": "hardCharacteristic", "family": "hardnessFamily", "real_name": "hard"}, {"visible": True, "order": 1, "name": "compactCharacteristic", "family": "porosityFamily", "real_name": "compact"}, {"visible": False, "order": 1, "name": "opaqueCharacteristic", "family": "opacityFamily", "real_name": "opaque"}, {"visible": True, "order": 10, "name": "darkGreenCharacteristic", "family": "colourFamily", "real_name": "dark green"}, {"visible": True, "order": 1, "name": "continuousCharacteristic", "family": "continuityFamily", "real_name": "continuous"}, {"visible": True, "order": 2, "name": "normalWidthCharacteristic", "family": "widthFamily", "real_name": "medium"}, {"visible": False, "order": 2, "name": "notMagneticCharacteristic", "family": "magnetismFamily", "real_name": "non magnetic"}, {"visible": False, "order": 10, "name": "matteCharacteristic", "family": "brightnessFamily", "real_name": "matte"}, {"visible": False, "order": 1, "name": "longitudinalCharacteristic", "family": "directionFamily", "real_name": "longitudinal"}, {"visible": True, "order": 2, "name": "normalThicknessCharacteristic", "family": "thicknessFamily", "real_name": "medium"}, {"visible": False, "order": 12, "name": "layerFilmCoatingCharacteristic", "family": "shapeFamily", "real_name": "layer/film/coating"}, {"visible": False, "order": 2, "name": "cpCharacteristic", "family": "natureFamily", "real_name": "Corrosion products"}], "interfaces": {"characteristics": [{"name": "sharpCharacteristic", "family": "interfaceTransitionFamily"}, {"name": "roughCharacteristic", "family": "interfaceRoughnessFamily"}, {"name": "irregularCharacteristic", "family": "interfaceProfileFamily"}], "name": "67d11e72-2574-11e6-a316-000c29148083_Strata1_interface1"}, "subcharacteristics": [], "children": [], "containers": {"cpCompositionMainElements": [{"category": "transition metal", "name": "Cu", "symbol": "Cu", "number": 29, "real_name": "Copper", "phase": "Solid", "version": 4, "date": "2018-02-09"}], "cpCompositionSecondaryElements": [{"category": "polyatomic nonmetal", "symbol": "S", "number": 16, "real_name": "Sulfur", "phase": "Solid", "version": 4, "date": "2018-02-09", "name": "S"}, {"category": "diatomic nonmetal", "symbol": "O", "number": 8, "real_name": "Oxygen", "phase": "Gas", "version": 4, "date": "2018-02-09", "name": "O"}, {"category": "diatomic nonmetal", "symbol": "H", "number": 1, "real_name": "Hydrogen", "phase": "Gas", "version": 4, "date": "2018-02-09", "name": "H"}], "cpCompositionAdditionalElements": [{"category": "metalloid", "name": "Si", "symbol": "Si", "number": 14, "real_name": "Silicon", "phase": "Solid", "version": 4, "date": "2018-02-09"}], "cpCompositionCompounds": [{"date": "2018-02-09", "real_name": "Brochantite (Cu4(OH)6SO4)", "version": 4, "name": "cpdBrochantite"}]}}, {"name": "67d11e72-2574-11e6-a316-000c29148083_Strata2", "characteristics": [{"visible": False, "order": 3, "name": "cpCuCharacteristic", "family": "cpCompositionFamily", "real_name": "Cu"}, {"visible": True, "order": 6, "name": "noMicrostructureCharacteristic", "family": "cpriMicrostructureFamily", "real_name": "no microstructure"}, {"visible": True, "order": 1, "name": "branchedCracksCharacteristic", "family": "crackingFamily", "real_name": "branched cracks"}, {"visible": False, "order": 6, "name": "toughCharacteristic", "family": "cohesionFamily", "real_name": "tough"}, {"visible": False, "order": 3, "name": "hardCharacteristic", "family": "hardnessFamily", "real_name": "hard"}, {"visible": True, "order": 1, "name": "compactCharacteristic", "family": "porosityFamily", "real_name": "compact"}, {"visible": False, "order": 1, "name": "opaqueCharacteristic", "family": "opacityFamily", "real_name": "opaque"}, {"visible": True, "order": 6, "name": "darkRedCharacteristic", "family": "colourFamily", "real_name": "dark red"}, {"visible": True, "order": 1, "name": "continuousCharacteristic", "family": "continuityFamily", "real_name": "continuous"}, {"visible": True, "order": 2, "name": "normalWidthCharacteristic", "family": "widthFamily", "real_name": "medium"}, {"visible": False, "order": 2, "name": "notMagneticCharacteristic", "family": "magnetismFamily", "real_name": "non magnetic"}, {"visible": False, "order": 10, "name": "matteCharacteristic", "family": "brightnessFamily", "real_name": "matte"}, {"visible": False, "order": 1, "name": "longitudinalCharacteristic", "family": "directionFamily", "real_name": "longitudinal"}, {"visible": True, "order": 3, "name": "thinCharacteristic", "family": "thicknessFamily", "real_name": "thin"}, {"visible": False, "order": 12, "name": "layerFilmCoatingCharacteristic", "family": "shapeFamily", "real_name": "layer/film/coating"}, {"visible": False, "order": 2, "name": "cpCharacteristic", "family": "natureFamily", "real_name": "Corrosion products"}], "interfaces": {"characteristics": [{"name": "adherentCharacteristic", "family": "interfaceAdherenceFamily"}, {"name": "sharpCharacteristic", "family": "interfaceTransitionFamily"}, {"name": "roughCharacteristic", "family": "interfaceRoughnessFamily"}, {"name": "irregularCharacteristic", "family": "interfaceProfileFamily"}], "name": "67d11e72-2574-11e6-a316-000c29148083_Strata2_interface2"}, "subcharacteristics": [], "children": [], "containers": {"cpCompositionMainElements": [{"category": "transition metal", "name": "Cu", "symbol": "Cu", "number": 29, "real_name": "Copper", "phase": "Solid", "version": 4, "date": "2018-02-09"}], "cpCompositionSecondaryElements": [{"category": "diatomic nonmetal", "symbol": "O", "number": 8, "real_name": "Oxygen", "phase": "Gas", "version": 4, "date": "2018-02-09", "name": "O"}], "cpCompositionAdditionalElements": [{"category": "polyatomic nonmetal", "symbol": "S", "number": 16, "real_name": "Sulfur", "phase": "Solid", "version": 4, "date": "2018-02-09", "name": "S"}], "cpCompositionCompounds": [{"date": "2018-02-09", "real_name": "Cuprite (Cu2O)", "version": 4, "name": "cpdCuprite"}]}}, {"name": "67d11e72-2574-11e6-a316-000c29148083_Strata3", "characteristics": [{"visible": True, "order": 3, "name": "grainLargeCharacteristic", "family": "mMicrostructureFamily", "real_name": "large grain"}, {"visible": True, "order": 3, "name": "noCracksCharacteristic", "family": "crackingFamily", "real_name": "no crack"}, {"visible": False, "order": 6, "name": "toughCharacteristic", "family": "cohesionFamily", "real_name": "tough"}, {"visible": False, "order": 3, "name": "hardCharacteristic", "family": "hardnessFamily", "real_name": "hard"}, {"visible": True, "order": 1, "name": "compactCharacteristic", "family": "porosityFamily", "real_name": "compact"}, {"visible": False, "order": 1, "name": "opaqueCharacteristic", "family": "opacityFamily", "real_name": "opaque"}, {"visible": True, "order": 1, "name": "continuousCharacteristic", "family": "continuityFamily", "real_name": "continuous"}, {"visible": True, "order": 2, "name": "normalWidthCharacteristic", "family": "widthFamily", "real_name": "medium"}, {"visible": False, "order": 2, "name": "notMagneticCharacteristic", "family": "magnetismFamily", "real_name": "non magnetic"}, {"visible": False, "order": 1, "name": "metallicCharacteristic", "family": "brightnessFamily", "real_name": "metallic"}, {"visible": False, "order": 1, "name": "longitudinalCharacteristic", "family": "directionFamily", "real_name": "longitudinal"}, {"visible": True, "order": 1, "name": "thickCharacteristic", "family": "thicknessFamily", "real_name": "thick"}, {"visible": False, "order": 16, "name": "parallelepipedalCharacteristic", "family": "shapeFamily", "real_name": "parallelepipedal"}, {"visible": True, "order": 7, "name": "pinkCharacteristic", "family": "colourFamily", "real_name": "pink"}, {"visible": False, "order": 4, "name": "mCharacteristic", "family": "natureFamily", "real_name": "Metal"}], "interfaces": {"characteristics": [{"name": "looselyCharacteristic", "family": "interfaceAdherenceFamily"}, {"name": "sharpCharacteristic", "family": "interfaceTransitionFamily"}, {"name": "roughCharacteristic", "family": "interfaceRoughnessFamily"}, {"name": "irregularCharacteristic", "family": "interfaceProfileFamily"}], "name": "67d11e72-2574-11e6-a316-000c29148083_Strata3_interface3"}, "subcharacteristics": [{"name": "inclusionsGrainLarge", "real_name": "inclusions"}, {"name": "twinLinesGrainLarge", "real_name": "twin lines / Newmann bands"}], "children": [], "containers": {"mCompositionMainElements": [{"category": "transition metal", "name": "Cu", "symbol": "Cu", "number": 29, "real_name": "Copper", "phase": "Solid", "version": 4, "date": "2018-02-09"}]}}], "uid": "67d11e72-2574-11e6-a316-000c29148083", "description": "Shingle of a roof"},
'67d11e72-2574-11e6-a316-000c29148083':{u"strata": [{u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata1", u"characteristics": [{u"visible": False, u"order": 13, u"name": u"cpExtensionSi", u"family": u"cpCompositionExtensionFamily", u"real_name": u"Si"}, {u"visible": False, u"order": 3, u"name": u"cpCuCharacteristic", u"family": u"cpCompositionFamily", u"real_name": u"Cu"}, {u"visible": True, u"order": 6, u"name": u"noMicrostructureCharacteristic", u"family": u"cpriMicrostructureFamily", u"real_name": u"no microstructure"}, {u"visible": True, u"order": 1, u"name": u"branchedCracksCharacteristic", u"family": u"crackingFamily", u"real_name": u"branched cracks"}, {u"visible": False, u"order": 6, u"name": u"toughCharacteristic", u"family": u"cohesionFamily", u"real_name": u"tough"}, {u"visible": False, u"order": 3, u"name": u"hardCharacteristic", u"family": u"hardnessFamily", u"real_name": u"hard"}, {u"visible": True, u"order": 1, u"name": u"compactCharacteristic", u"family": u"porosityFamily", u"real_name": u"compact"}, {u"visible": False, u"order": 1, u"name": u"opaqueCharacteristic", u"family": u"opacityFamily", u"real_name": u"opaque"}, {u"visible": True, u"order": 10, u"name": u"darkGreenCharacteristic", u"family": u"colourFamily", u"real_name": u"dark green"}, {u"visible": True, u"order": 1, u"name": u"continuousCharacteristic", u"family": u"continuityFamily", u"real_name": u"continuous"}, {u"visible": True, u"order": 2, u"name": u"normalWidthCharacteristic", u"family": u"widthFamily", u"real_name": u"medium"}, {u"visible": False, u"order": 2, u"name": u"notMagneticCharacteristic", u"family": u"magnetismFamily", u"real_name": u"non magnetic"}, {u"visible": False, u"order": 10, u"name": u"matteCharacteristic", u"family": u"brightnessFamily", u"real_name": u"matte"}, {u"visible": False, u"order": 1, u"name": u"longitudinalCharacteristic", u"family": u"directionFamily", u"real_name": u"longitudinal"}, {u"visible": True, u"order": 2, u"name": u"normalThicknessCharacteristic", u"family": u"thicknessFamily", u"real_name": u"medium"}, {u"visible": False, u"order": 12, u"name": u"layerFilmCoatingCharacteristic", u"family": u"shapeFamily", u"real_name": u"layer/film/coating"}, {u"visible": False, u"order": 2, u"name": u"cpCharacteristic", u"family": u"natureFamily", u"real_name": u"Corrosion products"}], u"interfaces": {u"characteristics": [{u"name": u"sharpCharacteristic", u"family": u"interfaceTransitionFamily"}, {u"name": u"roughCharacteristic", u"family": u"interfaceRoughnessFamily"}, {u"name": u"irregularCharacteristic", u"family": u"interfaceProfileFamily"}], u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata1_interface1"}, u"subcharacteristics": [], u"children": [], u"containers": {u"cpCompositionMainElements": [{u"category": u"transition metal", u"name": u"Cu", u"symbol": u"Cu", u"number": 29, u"real_name": u"Copper", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09"}], u"cpCompositionSecondaryElements": [{u"category": u"polyatomic nonmetal", u"symbol": u"S", u"number": 16, u"real_name": u"Sulfur", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09", u"name": u"S"}, {u"category": u"diatomic nonmetal", u"symbol": u"O", u"number": 8, u"real_name": u"Oxygen", u"phase": u"Gas", u"version": 4, u"date": u"2018-02-09", u"name": u"O"}, {u"category": u"diatomic nonmetal", u"symbol": u"H", u"number": 1, u"real_name": u"Hydrogen", u"phase": u"Gas", u"version": 4, u"date": u"2018-02-09", u"name": u"H"}], u"cpCompositionAdditionalElements": [{u"category": u"metalloid", u"name": u"Si", u"symbol": u"Si", u"number": 14, u"real_name": u"Silicon", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09"}], u"cpCompositionCompounds": [{u"date": u"2018-02-09", u"real_name": u"Brochantite (Cu4(OH)6SO4)", u"version": 4, u"name": u"cpdBrochantite"}]}}, {u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata2", u"characteristics": [{u"visible": False, u"order": 3, u"name": u"cpCuCharacteristic", u"family": u"cpCompositionFamily", u"real_name": u"Cu"}, {u"visible": True, u"order": 6, u"name": u"noMicrostructureCharacteristic", u"family": u"cpriMicrostructureFamily", u"real_name": u"no microstructure"}, {u"visible": True, u"order": 1, u"name": u"branchedCracksCharacteristic", u"family": u"crackingFamily", u"real_name": u"branched cracks"}, {u"visible": False, u"order": 6, u"name": u"toughCharacteristic", u"family": u"cohesionFamily", u"real_name": u"tough"}, {u"visible": False, u"order": 3, u"name": u"hardCharacteristic", u"family": u"hardnessFamily", u"real_name": u"hard"}, {u"visible": True, u"order": 1, u"name": u"compactCharacteristic", u"family": u"porosityFamily", u"real_name": u"compact"}, {u"visible": False, u"order": 1, u"name": u"opaqueCharacteristic", u"family": u"opacityFamily", u"real_name": u"opaque"}, {u"visible": True, u"order": 6, u"name": u"darkRedCharacteristic", u"family": u"colourFamily", u"real_name": u"dark red"}, {u"visible": True, u"order": 1, u"name": u"continuousCharacteristic", u"family": u"continuityFamily", u"real_name": u"continuous"}, {u"visible": True, u"order": 2, u"name": u"normalWidthCharacteristic", u"family": u"widthFamily", u"real_name": u"medium"}, {u"visible": False, u"order": 2, u"name": u"notMagneticCharacteristic", u"family": u"magnetismFamily", u"real_name": u"non magnetic"}, {u"visible": False, u"order": 10, u"name": u"matteCharacteristic", u"family": u"brightnessFamily", u"real_name": u"matte"}, {u"visible": False, u"order": 1, u"name": u"longitudinalCharacteristic", u"family": u"directionFamily", u"real_name": u"longitudinal"}, {u"visible": True, u"order": 3, u"name": u"thinCharacteristic", u"family": u"thicknessFamily", u"real_name": u"thin"}, {u"visible": False, u"order": 12, u"name": u"layerFilmCoatingCharacteristic", u"family": u"shapeFamily", u"real_name": u"layer/film/coating"}, {u"visible": False, u"order": 2, u"name": u"cpCharacteristic", u"family": u"natureFamily", u"real_name": u"Corrosion products"}], u"interfaces": {u"characteristics": [{u"name": u"adherentCharacteristic", u"family": u"interfaceAdherenceFamily"}, {u"name": u"sharpCharacteristic", u"family": u"interfaceTransitionFamily"}, {u"name": u"roughCharacteristic", u"family": u"interfaceRoughnessFamily"}, {u"name": u"irregularCharacteristic", u"family": u"interfaceProfileFamily"}], u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata2_interface2"}, u"subcharacteristics": [], u"children": [], u"containers": {u"cpCompositionMainElements": [{u"category": u"transition metal", u"name": u"Cu", u"symbol": u"Cu", u"number": 29, u"real_name": u"Copper", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09"}], u"cpCompositionSecondaryElements": [{u"category": u"diatomic nonmetal", u"symbol": u"O", u"number": 8, u"real_name": u"Oxygen", u"phase": u"Gas", u"version": 4, u"date": u"2018-02-09", u"name": u"O"}], u"cpCompositionAdditionalElements": [{u"category": u"polyatomic nonmetal", u"symbol": u"S", u"number": 16, u"real_name": u"Sulfur", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09", u"name": u"S"}], u"cpCompositionCompounds": [{u"date": u"2018-02-09", u"real_name": u"Cuprite (Cu2O)", u"version": 4, u"name": u"cpdCuprite"}]}}, {u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata3", u"characteristics": [{u"visible": True, u"order": 3, u"name": u"grainLargeCharacteristic", u"family": u"mMicrostructureFamily", u"real_name": u"large grain"}, {u"visible": True, u"order": 3, u"name": u"noCracksCharacteristic", u"family": u"crackingFamily", u"real_name": u"no crack"}, {u"visible": False, u"order": 6, u"name": u"toughCharacteristic", u"family": u"cohesionFamily", u"real_name": u"tough"}, {u"visible": False, u"order": 3, u"name": u"hardCharacteristic", u"family": u"hardnessFamily", u"real_name": u"hard"}, {u"visible": True, u"order": 1, u"name": u"compactCharacteristic", u"family": u"porosityFamily", u"real_name": u"compact"}, {u"visible": False, u"order": 1, u"name": u"opaqueCharacteristic", u"family": u"opacityFamily", u"real_name": u"opaque"}, {u"visible": True, u"order": 1, u"name": u"continuousCharacteristic", u"family": u"continuityFamily", u"real_name": u"continuous"}, {u"visible": True, u"order": 2, u"name": u"normalWidthCharacteristic", u"family": u"widthFamily", u"real_name": u"medium"}, {u"visible": False, u"order": 2, u"name": u"notMagneticCharacteristic", u"family": u"magnetismFamily", u"real_name": u"non magnetic"}, {u"visible": False, u"order": 1, u"name": u"metallicCharacteristic", u"family": u"brightnessFamily", u"real_name": u"metallic"}, {u"visible": False, u"order": 1, u"name": u"longitudinalCharacteristic", u"family": u"directionFamily", u"real_name": u"longitudinal"}, {u"visible": True, u"order": 1, u"name": u"thickCharacteristic", u"family": u"thicknessFamily", u"real_name": u"thick"}, {u"visible": False, u"order": 16, u"name": u"parallelepipedalCharacteristic", u"family": u"shapeFamily", u"real_name": u"parallelepipedal"}, {u"visible": True, u"order": 7, u"name": u"pinkCharacteristic", u"family": u"colourFamily", u"real_name": u"pink"}, {u"visible": False, u"order": 4, u"name": u"mCharacteristic", u"family": u"natureFamily", u"real_name": u"Metal"}], u"interfaces": {u"characteristics": [{u"name": u"looselyCharacteristic", u"family": u"interfaceAdherenceFamily"}, {u"name": u"sharpCharacteristic", u"family": u"interfaceTransitionFamily"}, {u"name": u"roughCharacteristic", u"family": u"interfaceRoughnessFamily"}, {u"name": u"irregularCharacteristic", u"family": u"interfaceProfileFamily"}], u"name": u"67d11e72-2574-11e6-a316-000c29148083_Strata3_interface3"}, u"subcharacteristics": [{u"name": u"inclusionsGrainLarge", u"real_name": u"inclusions"}, {u"name": u"twinLinesGrainLarge", u"real_name": u"twin lines / Newmann bands"}], u"children": [], u"containers": {u"mCompositionMainElements": [{u"category": u"transition metal", u"name": u"Cu", u"symbol": u"Cu", u"number": 29, u"real_name": u"Copper", u"phase": u"Solid", u"version": 4, u"date": u"2018-02-09"}]}}], u"uid": u"67d11e72-2574-11e6-a316-000c29148083", u"description": u"Shingle of a roof"},

}
class MicorrService(TestCase):
    """ Test module for micorrservice API """

    def setUp(self):
        self.client = Client()

    def test_getstratigraphydetails(self):
        # get API response
        # response = self.client.get('/micorr/json/getstratigraphydetails/')
        # self.assertEqual(response.status_code, 404)
        # we don't do actual service test as no neo4j test db is setup on travis.ci for now
        for s_uid in STRATIGRAPHY_REFS:
            response = self.client.get('/micorr/json/getstratigraphydetails/{uid}'.format(uid=s_uid))
            self.assertEqual(response.status_code, 200)
            stratigraphy = response.json()
            self.assertTrue('strata' in stratigraphy)
            self.assertTrue('description' in stratigraphy)
            self.assertTrue(len(stratigraphy['strata'])>0)
            str_ref = json.dumps(STRATIGRAPHY_REFS[s_uid], sort_keys=True)
            str_test = json.dumps(stratigraphy, sort_keys=True)
            print('\n/micorr/json/getstratigraphydetails/{uid} =>\n{dump}'.format(uid=s_uid,dump=str_test))
            #cmp_res=jsoncompare.are_same(str_ref, str_test, True)
            cmp_res=jsoncompare.are_same(STRATIGRAPHY_REFS[s_uid], stratigraphy, True)
            ddiff = DeepDiff(STRATIGRAPHY_REFS[s_uid], stratigraphy, ignore_order=True)
            if ddiff:
                print(ddiff)
            #if not cmp_res[0]:
            #    print(cmp_res[1])
            self.assertTrue(cmp_res[0])

            # self.assertEqual(str_ref, str_test)

